var H=Object.defineProperty;var M=(a,c,i)=>c in a?H(a,c,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[c]=i;var J=(a,c,i)=>(M(a,typeof c!="symbol"?c+"":c,i),i);import{d as O,r as I,c as N,a as W,o as U,b as y,e as _,f as p,u as E,g as T,t as C,h as $,n as R,i as V,j as G,F as k,k as w,p as D,w as L,v as F,l as P,m as Y,q as z,s as K,x as X,y as Z,_ as Q}from"./index-e1e68f68.js";import{a as A,b as ee}from"./QQ-1125eaf1.js";const te={class:"select"},ne=["type","id","name"],oe=["for"],se=O({__name:"s-option",props:{modelValue:{type:[String,Array]},optionNum:{type:String},label:{type:String},type:{type:String},name:{type:String},value:{type:String}},emits:["update:modelValue"],setup(a,{emit:c}){const i=a,d=c,x=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),f=I(null),g=N(()=>i.modelValue===b.value),u=W({isChecked:g,inputValue:"",hasInput:!1,labelSplit:[""],selected:[]}),v=N({get(){return i.modelValue},set(e){d("update:modelValue",e)}}),b=N(()=>{let e="";return u.labelSplit.forEach(o=>{o.includes("&input")?e+=`%&${u.inputValue}%`:o.includes("&select")?e+="%&select"+JSON.stringify(u.selected)+"%":e+=o}),i.optionNum+"-"+e}),n=e=>{try{return e.startsWith("{")&&e.endsWith("}")?JSON.parse(e):e}catch(o){console.warn("convertJSON error",o)}},r=async()=>{var o;const e=b.value;i.type==="checkbox"&&Array.isArray(v.value)?(o=f==null?void 0:f.value)!=null&&o.checked?(v.value=v.value.filter(l=>{if(!l.startsWith(i.optionNum+"-"))return l}),await R(),v.value.push(e)):v.value=v.value.filter(l=>{if(!l.startsWith(i.optionNum+"-"))return l}):v.value=e},t=x(),s=N(()=>()=>u.labelSplit.map(e=>{var o;if(e.startsWith("&input")){const l=e.replace("&input",""),m=n(l);return V("input",{type:"text",value:u.inputValue,...m,onInput:h=>{const S=h.target;u.inputValue=S.value,f!=null&&f.value&&(f.value.checked=!0,r())}})}else if(e.startsWith("&select")){const l=e.replace("&select",""),m=n(l);return g.value?V("div",{class:"dS"},(o=m==null?void 0:m.options)==null?void 0:o.map(h=>{const S=x();return V("div",[V("input",{type:"checkbox",value:h,id:S,onInput:q=>{q.target.checked?u.selected.push(h):u.selected=u.selected.filter(j=>j!==h),r()}}),V("label",{for:S},h)])})):""}else return e}));return U(()=>{var e,o;u.labelSplit=((e=i.label)==null?void 0:e.split("%"))??[],(o=u.labelSplit)==null||o.forEach(l=>{l.startsWith("&input")&&(u.hasInput=!0)})}),(e,o)=>(y(),_("div",te,[p("input",{type:a.type,id:E(t),name:a.name,onInput:r,ref_key:"checkBox",ref:f},null,40,ne),p("label",{for:E(t)},[T("("+C(a.optionNum)+") ",1),$(E(s))],8,oe)]))}});const ae=["id"],re=O({__name:"s-select",props:{modelValue:{type:[String,Array]},type:{type:String,default:"single",validate:a=>["single","multiple"].includes(a)},question:{type:String},options:{type:Array},required:{type:Boolean},questionNum:{type:String},ageArea:{type:String},multiple:{type:Boolean}},emits:["update:modelValue"],setup(a,{emit:c}){G("selectAgeArea",I(""));const i=a,d=c,x=N({get(){return i.modelValue},set(f){d("update:modelValue",f)}});return(f,g)=>(y(),_("div",null,[p("h3",{class:"small-q",id:"q"+a.questionNum},C((a.questionNum??"")+a.question),9,ae),(y(!0),_(k,null,w(a.options,(u,v)=>(y(),_("div",{key:u,class:"option"},[$(se,{type:a.multiple?"checkbox":"radio",name:a.questionNum,"option-num":v+1+"",label:u,modelValue:x.value,"onUpdate:modelValue":g[0]||(g[0]=b=>x.value=b)},null,8,["type","name","option-num","label","modelValue"])]))),128))]))}});const B=a=>(K("data-v-fa55d943"),a=a(),X(),a),le={class:"container"},ie={class:"reqBox"},ue=B(()=>p("h2",null,"兒少生活樣態訪視檢視清單",-1)),ce={class:"name-box"},de=B(()=>p("label",{for:"name"},"姓名：",-1)),pe={class:"name-box"},fe=B(()=>p("label",{for:""},"年齡層：",-1)),me=Z('<option value="" data-v-fa55d943>請選擇年齡層</option><option value="PRESCHOOL" data-v-fa55d943>幼兒園</option><option value="ELEMENTARY" data-v-fa55d943>國小</option><option value="JUNIOR_HIGH" data-v-fa55d943>國中</option><option value="HIGH_SCHOOL" data-v-fa55d943>高中</option><option value="COLLEGE" data-v-fa55d943>大專</option>',6),ve=[me],he={class:"big"},ye={key:0,class:"big-q"},_e={class:"big-title"},xe=O({__name:"Survey-com",setup(a){const c=I(""),i=I("");D("selectAgeArea",i);const d=W({});A.forEach(n=>{d[n.idx]={},n.questions.forEach(r=>{r.type=="multiple"?d[n.idx][r.idx]=[]:d[n.idx][r.idx]=""})});const x=I(null),f=n=>{let r;if(n.includes("%&"))r=n.split("%"),r.forEach(t=>{var s;if(t.includes("&select")){t=t.replace("&select","");try{if(!(((s=JSON.parse(t))==null?void 0:s.length)>0))throw console.log(JSON.parse(t)),new Error}catch{throw new Error("請勾選額外項目")}}else if(t.includes("&")&&(t=t.replace("&",""),t=t.trim(),!t))throw new Error("請填寫輸入框內容")});else if(n=n.trim(),n.length==0)throw new Error("未勾選任何項目")},g=n=>{var s,e,o,l,m,h,S;if(!n.require)return!0;const r=((e=(s=n.require)==null?void 0:s.idx.split("-"))==null?void 0:e[0])??"",t=((o=n.require)==null?void 0:o.idx)??"";if(!t||!r)return!0;if(Array.isArray((l=n.require)==null?void 0:l.ansIdx)){for(const q of n.require.ansIdx)if(((m=d[r][t].split("-"))==null?void 0:m[0])==q)return!0}else if(((h=d[r][t].split("-"))==null?void 0:h[0])==((S=n.require)==null?void 0:S.ansIdx))return!0};class u extends Error{constructor(t,s){super(t);J(this,"idx");this.name="CustomError",this.idx=s}}const v=n=>{var e;const r=(e=n.idx.split("-"))==null?void 0:e[0],t=n.idx,s=d[r][t];if(g(n))try{if(s instanceof Array){if(s.length==0)throw new u("未勾選任何項目",n.idx);s.forEach(o=>{f(o)})}else typeof s=="string"&&f(s)}catch(o){throw new u(o.message,n.idx)}},b=()=>{var t,s;let n={};if(!c.value){alert("請輸入姓名"),(t=x.value)==null||t.focus();return}if(!i.value){alert("請選擇年齡層");return}for(const e in d)for(const o in d[e]){const l=d[e][o];(l instanceof Array&&l.length>0||l&&Object.keys(l).length>0)&&(n[o]=l)}try{A.forEach(e=>{e.ageArea.includes(i.value)&&e.questions.forEach(o=>{v(o)})})}catch(e){const{idx:o,message:l}=e,m=document.getElementById("q"+o),h=(m==null?void 0:m.offsetTop)??0;(s=document.querySelector("html"))==null||s.scroll({top:h-80,behavior:"smooth"}),alert("題號"+o+":"+l);return}const r={userName:c.value,answer:n};ee.post("/survey",r).then(e=>{alert("送出成功"),location.reload()})};return(n,r)=>(y(),_("div",le,[p("div",ie,[ue,p("div",ce,[de,L(p("input",{type:"text",id:"name","onUpdate:modelValue":r[0]||(r[0]=t=>c.value=t),ref_key:"nameInput",ref:x},null,512),[[F,c.value]])]),p("div",pe,[fe,L(p("select",{name:"",id:"","onUpdate:modelValue":r[1]||(r[1]=t=>i.value=t)},ve,512),[[P,i.value]])])]),p("div",he,[(y(!0),_(k,null,w(E(A),t=>(y(),_(k,{key:"big"+t.idx},[t.ageArea.includes(i.value)?(y(),_("div",ye,[p("h3",_e,C(t.label),1),(y(!0),_(k,null,w(t.questions,s=>(y(),Y(re,{key:s.idx,modelValue:d[t.idx][s.idx],"onUpdate:modelValue":e=>d[t.idx][s.idx]=e,type:s.type,options:s.option,questionNum:s.idx,question:s.question,multiple:s.type=="multiple"},null,8,["modelValue","onUpdate:modelValue","type","options","questionNum","question","multiple"]))),128))])):z("",!0)],64))),128))]),p("div",{class:"button-box"},[p("button",{class:"btn btn-submit",onClick:b},"送出")])]))}});const Ne=Q(xe,[["__scopeId","data-v-fa55d943"]]);export{Ne as default};
