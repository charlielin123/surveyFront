import{d as O,r as I,c as N,a as L,o as j,b as h,e as _,f as p,u as k,g as H,t as C,h as W,n as M,i as V,j as U,F as q,k as w,p as T,w as J,v as R,l as G,m as D,q as F,s as P,x as Y,y as z,_ as K}from"./index-60198140.js";import{a as E,b as X}from"./QQ-416db5a0.js";const Z={class:"select"},Q=["type","id","name"],ee=["for"],te=O({__name:"s-option",props:{modelValue:{type:[String,Array]},optionNum:{type:String},label:{type:String},type:{type:String},name:{type:String},value:{type:String}},emits:["update:modelValue"],setup(l,{emit:g}){const c=l,d=g,x=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),m=I(null),b=N(()=>c.modelValue===n.value),u=L({isChecked:b,inputValue:"",hasInput:!1,labelSplit:[""],selected:[]}),f=N({get(){return c.modelValue},set(e){d("update:modelValue",e)}}),n=N(()=>{let e="";return u.labelSplit.forEach(o=>{o.includes("&input")?e+=`%&${u.inputValue}%`:o.includes("&select")?e+="%&select"+JSON.stringify(u.selected)+"%":e+=o}),c.optionNum+"-"+e}),a=e=>{try{return e.startsWith("{")&&e.endsWith("}")?JSON.parse(e):e}catch(o){console.warn("convertJSON error",o)}},t=async()=>{var o;const e=n.value;c.type==="checkbox"&&Array.isArray(f.value)?(o=m==null?void 0:m.value)!=null&&o.checked?(f.value=f.value.filter(i=>{if(!i.startsWith(c.optionNum+"-"))return i}),await M(),f.value.push(e)):f.value=f.value.filter(i=>{if(!i.startsWith(c.optionNum+"-"))return i}):f.value=e},s=x(),r=N(()=>()=>u.labelSplit.map(e=>{var o;if(e.startsWith("&input")){const i=e.replace("&input",""),v=a(i);return V("input",{type:"text",value:u.inputValue,...v,onInput:y=>{const S=y.target;u.inputValue=S.value,m!=null&&m.value&&(m.value.checked=!0,t())}})}else if(e.startsWith("&select")){const i=e.replace("&select",""),v=a(i);return b.value?V("div",{class:"dS"},(o=v==null?void 0:v.options)==null?void 0:o.map(y=>{const S=x();return V("div",[V("input",{type:"checkbox",value:y,id:S,onInput:A=>{A.target.checked?u.selected.push(y):u.selected=u.selected.filter($=>$!==y),t()}}),V("label",{for:S},y)])})):""}else return e}));return j(()=>{var e,o;u.labelSplit=((e=c.label)==null?void 0:e.split("%"))??[],(o=u.labelSplit)==null||o.forEach(i=>{i.startsWith("&input")&&(u.hasInput=!0)})}),(e,o)=>(h(),_("div",Z,[p("input",{type:l.type,id:k(s),name:l.name,onInput:t,ref_key:"checkBox",ref:m},null,40,Q),p("label",{for:k(s)},[H("("+C(l.optionNum)+") ",1),W(k(r))],8,ee)]))}});const ne=["id"],oe=O({__name:"s-select",props:{modelValue:{type:[String,Array]},type:{type:String,default:"single",validate:l=>["single","multiple"].includes(l)},question:{type:String},options:{type:Array},required:{type:Boolean},questionNum:{type:String},ageArea:{type:String},multiple:{type:Boolean}},emits:["update:modelValue"],setup(l,{emit:g}){U("selectAgeArea",I(""));const c=l,d=g,x=N({get(){return c.modelValue},set(m){d("update:modelValue",m)}});return(m,b)=>(h(),_("div",null,[p("h3",{class:"small-q",id:"q"+l.questionNum},C((l.questionNum??"")+l.question),9,ne),(h(!0),_(q,null,w(l.options,(u,f)=>(h(),_("div",{key:u,class:"option"},[W(te,{type:l.multiple?"checkbox":"radio",name:l.questionNum,"option-num":f+1+"",label:u,modelValue:x.value,"onUpdate:modelValue":b[0]||(b[0]=n=>x.value=n)},null,8,["type","name","option-num","label","modelValue"])]))),128))]))}});const B=l=>(P("data-v-ae4db435"),l=l(),Y(),l),se={class:"container"},ae={class:"reqBox"},le=B(()=>p("h2",null,"兒少生活樣態訪視檢視清單",-1)),re={class:"name-box"},ie=B(()=>p("label",{for:"name"},"姓名：",-1)),ue={class:"name-box"},ce=B(()=>p("label",{for:""},"年齡層：",-1)),de=z('<option value="" data-v-ae4db435>請選擇年齡層</option><option value="PRESCHOOL" data-v-ae4db435>幼兒園</option><option value="ELEMENTARY" data-v-ae4db435>國小</option><option value="JUNIOR_HIGH" data-v-ae4db435>國中</option><option value="HIGH_SCHOOL" data-v-ae4db435>高中</option><option value="COLLEGE" data-v-ae4db435>大專</option>',6),pe=[de],me={class:"big"},fe={key:0,class:"big-q"},ve={class:"big-title"},he=O({__name:"Survey-com",setup(l){const g=I(""),c=I("");T("selectAgeArea",c);const d=L({});E.forEach(n=>{d[n.idx]={},n.questions.forEach(a=>{a.type=="multiple"?d[n.idx][a.idx]=[]:d[n.idx][a.idx]=""})});const x=I(null),m=n=>{let a;if(n.includes("%&"))a=n.split("%"),a.forEach(t=>{var s;if(t.includes("&select")){t=t.replace("&select","");try{if(!(((s=JSON.parse(t))==null?void 0:s.length)>0))throw console.log(JSON.parse(t)),new Error}catch{throw new Error("請勾選額外項目")}}else if(t.includes("&")&&(t=t.replace("&",""),t=t.trim(),!t))throw new Error("請填寫輸入框內容")});else if(n=n.trim(),n.length==0)throw new Error("未勾選任何項目")},b=n=>{var s,r,e,o,i,v,y,S;if(!n.require)return!1;console.log((s=n.require)==null?void 0:s.idx);const a=((e=(r=n.require)==null?void 0:r.idx.split("-"))==null?void 0:e[0])??"",t=((o=n.require)==null?void 0:o.idx)??"";if(!t||!a)return!1;if(Array.isArray((i=n.require)==null?void 0:i.ansIdx)){for(const A of n.require.ansIdx)if(((v=d[a][t].split("-"))==null?void 0:v[0])==A)return!0}else if(((y=d[a][t].split("-"))==null?void 0:y[0])!=((S=n.require)==null?void 0:S.ansIdx))return!0},u=n=>{var r;const a=(r=n.idx.split("-"))==null?void 0:r[0],t=n.idx,s=d[a][t];if(b(n))try{if(s instanceof Array){if(s.length==0)throw{idx:n.idx,message:"未勾選任何項目"};s.forEach(e=>{m(e)})}else typeof s=="string"&&m(s)}catch(e){throw{idx:n.idx,message:e.message}}},f=()=>{var t,s;let n={};if(!g.value){alert("請輸入姓名"),(t=x.value)==null||t.focus();return}if(!c.value){alert("請選擇年齡層");return}for(const r in d)for(const e in d[r]){const o=d[r][e];(o instanceof Array&&o.length>0||o&&Object.keys(o).length>0)&&(n[e]=o)}try{E.forEach(r=>{r.ageArea.includes(c.value)&&r.questions.forEach(e=>{u(e)})})}catch(r){const{idx:e,message:o}=r,i=document.getElementById("q"+e),v=(i==null?void 0:i.offsetTop)??0;(s=document.querySelector("html"))==null||s.scroll({top:v-80,behavior:"smooth"}),alert("題號"+e+":"+o);return}const a={userName:g.value,answer:n};X.post("/survey",a).then(r=>{alert("送出成功"),location.reload()})};return(n,a)=>(h(),_("div",se,[p("div",ae,[le,p("div",re,[ie,J(p("input",{type:"text",id:"name","onUpdate:modelValue":a[0]||(a[0]=t=>g.value=t),ref_key:"nameInput",ref:x},null,512),[[R,g.value]])]),p("div",ue,[ce,J(p("select",{name:"",id:"","onUpdate:modelValue":a[1]||(a[1]=t=>c.value=t)},pe,512),[[G,c.value]])])]),p("div",me,[(h(!0),_(q,null,w(k(E),t=>(h(),_(q,{key:"big"+t.idx},[t.ageArea.includes(c.value)?(h(),_("div",fe,[p("h3",ve,C(t.label),1),(h(!0),_(q,null,w(t.questions,s=>(h(),D(oe,{key:s.idx,modelValue:d[t.idx][s.idx],"onUpdate:modelValue":r=>d[t.idx][s.idx]=r,type:s.type,options:s.option,questionNum:s.idx,question:s.question,multiple:s.type=="multiple"},null,8,["modelValue","onUpdate:modelValue","type","options","questionNum","question","multiple"]))),128))])):F("",!0)],64))),128))]),p("div",{class:"button-box"},[p("button",{class:"btn btn-submit",onClick:f},"送出")])]))}});const xe=K(he,[["__scopeId","data-v-ae4db435"]]);export{xe as default};
